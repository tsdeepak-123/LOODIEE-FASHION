
{{!-- style modal---------------------- --}}
<style>
  .modal-dialog{
    height: 50%;
    width: 50%;
    margin: auto;
}

.text1{
    background-color: #dc3545;
    color: white;
    width: 30%;
    margin-top: 5%;
    text-align: center;
}

.icon2{
 color: #dc3545;
}

.modal-header{
    color: white;
    background-color: #dc3545;

}
.openmodal{
    margin-left: 10%;
    width: 10%;
   
  }
  .coupon-input {
    width: 200px;
  }
</style>
{{!-- style modal---------------------- --}}








        <!--====== App Content ======-->
        <div class="app-content">

            <!--====== Section 1 ======-->
            <div class="u-s-p-y-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="breadcrumb">
                            <div class="breadcrumb__wrap">
                                <ul class="breadcrumb__list">
                                    <li class="has-separator">

                                        <a href="/">Home</a></li>
                                    <li class="is-marked">

                                        <a href="">Checkout</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--====== End - Section 1 ======-->


            <!--====== Section 2 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div id="checkout-msg-group">
{{!------------------------------------------ adress-------------------------------------------------------- --}}
                                   <div class="msg u-s-m-b-30">
                                  <span class="msg__text">Already added a address?        
                                            
                                
                                <!-- Button trigger modal -->
<a data-toggle="modal" data-target="#exampleModal">
  <span style="color:orangered;">Select Address</span> </a></span></div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
         {{#each Addressess.address}}
         <div class="card" style="width: 18rem;border:none">
  <div class="card-body">
    <h5 class="card-title">Address</h5>
    <a type="submit" href="/select?id={{_id}}" class="btn btn-primary" >select</a>
    <p class="card-text">{{firstname}} <br>{{streetaddress}} <br>{{town}} <br>{{district}} <br>{{state}} <br>{{email}}</p>
  </div>
</div>
{{/each}}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

{{!-- ------------------------------address------------------------------------------------------- --}}



                                <div class="msg u-s-m-b-30">
                                    {{!-- ------------------------------coupon------------------------------------------------------- --}}
{{!-- <button type="button" class="btn btn-info btn-lg openmodal" data-toggle="modal" data-target="#myModal">Open
  Modal</button> --}}
  <a class="openmodal" style="color: green;margin-left:51vw" data-toggle="modal" data-target="#myModal" href=""><i class="fa-solid fa-tags" style="color: #22a02a;"></i>View Coupons</a>

<!--Division for Modal-->
<div id="myModal" class="modal fade" role="dialog">

  <div class="modal-dialog">
{{#each couponData}}
    <!--Modal Content-->
    <div class="modal-content">

      <!-- Modal Header-->
      <div class="modal-header">
        <h3>Discount offer:₹ {{discountAmount}} off</h3>

        <!--Close/Cross Button-->
        <button type="button" class="close" data-dismiss="modal" style="color: white;">&times;</button>
      </div>

      <!-- Modal Body-->
      <div class="modal-body">
        <div class="row">

          <!--Gift Icon-->
          <div class="col text-center">
            <i class="fa fa-gift fa-4x icon2"></i>
          </div>

          <!--Modal Text-->
          <div class="col-8">
            <p>We care for our visitors and from time to time we provide small gifts to them.
              </p>
            <h6>
              Hurry! Copy the below code and use it at checkout within <u>a day</u>
            </h6>
            <h3 class="text1">{{couponCode}}</h3>
            <p>₹ {{discountAmount}} Discount for Minimum Purchase of ₹ {{minAmount}}</p>
          </div>

        </div>
      </div>

      <!-- Modal Footer-->
      <div class="modal-footer">
        <a href="">Expiry Date{{expiryDate}}
          <i class="fa fa-gem"></i>
        </a>
        <a href="" class="btn btn-outline-danger" data-dismiss="modal">No, thanks</a>
      </div>

    </div>
{{/each}}
  </div>
</div>

{{!-- ------------------------------coupon------------------------------------------------------- --}}

                            
                            <div class="form-group"> <label style="color: black;">Have coupon?</label>
                                <div class="input-group">
                                     <input type="text"name="couponId" id="couponId"style="width: 165px;" placeholder="Coupon code">
                                <span class="input-group-append"> 
                                    <button style="height:40px; width:100px; background-color:orangered; color:white; border:none;" onclick="couponValidator('{{totalAmount}}')">
                                        Apply</button> </span> </div>
                            </div>
                             <h6 style="color: RED;" id="couponspan"></h6>
                    
                </div>


                
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 2 ======-->


            <!--====== Section 3 ======-->
            <div class="u-s-p-b-60">

                <!--====== Section Content ======-->
                <div class="section__content">
                    <div class="container">
                        <div class="checkout-f">
                            <div class="row">
                                <div class="col-lg-6">
                                    <h1 class="checkout-f__h1">DELIVERY INFORMATION</h1>
                                    <form class="checkout-f__delivery" action="/add-address" method="post">
                                        <div class="u-s-m-b-30">
                                            <div class="u-s-m-b-15">

                                                <!--====== Check Box ======-->
                                                <div class="check-box">

                                                    <input type="checkbox" id="get-address">
                                                    <div class="check-box__state check-box__state--primary">

                                                        <label class="check-box__label" for="get-address">Use default shipping and billing address from account</label></div>
                                                </div>
                                                <!--====== End - Check Box ======-->
                                            </div>

                                            <!--====== First Name, Last Name ======-->
                                            <div class="gl-inline">
                                                <div class="u-s-m-b-15">

                                                    <label class="gl-label"  for="billing-fname">FIRST NAME *</label>

                                                    <input class="input-text input-text--primary-style" name="firstname" type="text" id="billing-fname" data-bill=""></div>
                                                <div class="u-s-m-b-15">

                                                    <label class="gl-label"  for="billing-lname">LAST NAME *</label>

                                                    <input class="input-text input-text--primary-style" name="lastname" type="text" id="billing-lname" data-bill=""></div>
                                            </div>
                                            <!--====== End - First Name, Last Name ======-->


                                            <!--====== E-MAIL ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label"  for="billing-email">E-MAIL *</label>

                                                <input class="input-text input-text--primary-style"name="email" type="text" id="billing-email" data-bill=""></div>
                                            <!--====== End - E-MAIL ======-->


                                            <!--====== PHONE ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label" for="billing-phone">PHONE *</label>

                                                <input class="input-text input-text--primary-style" name="phone" type="text" id="billing-phone" data-bill=""></div>
                                            <!--====== End - PHONE ======-->


                                            <!--====== Street Address ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label"  for="billing-street">STREET ADDRESS *</label>

                                                <input class="input-text input-text--primary-style" name="streetaddress" type="text" id="billing-street" placeholder="House name and street name" data-bill=""></div>
                    
                                            <!--====== End - Street Address ======-->


                                            <!--====== Country ======-->
                                       
                                            <!--====== End - Country ======-->


                                            <!--====== Town / City ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label"  for="billing-town-city">TOWN/CITY *</label>

                                                <input class="input-text input-text--primary-style" name="town" type="text" id="billing-town-city" data-bill=""></div>
                                            <!--====== End - Town / City ======-->


                                            <!--====== STATE/PROVINCE ======-->
                                            <div class="u-s-m-b-15">

                                                <!--====== Select Box ======-->

                                                <label class="gl-label" for="billing-state">STATE/PROVINCE *</label>
                                                <select class="select-box select-box--primary-style"  name="state" id="billing-state" data-bill="">
                                                    <option  selected value="">Choose State</option>
                                                    <option value="KERALA">KERALA</option>
                                                    <option value="THAMILNAD">THAMILNAD</option>
                                                    <option value="KARNATAKA">KARNATAKA</option>
                                                </select>
                                                <!--====== End - Select Box ======-->
                                            </div>
                                            <!--====== End - STATE/PROVINCE ======-->
                                                
                                                <div class="u-s-m-b-15">

                                                <label class="gl-label"  for="billing-email">DISTRICT *</label>

                                                <input class="input-text input-text--primary-style"name="district" type="text" id="billing-email" data-bill=""></div>

                                            <!--====== ZIP/POSTAL ======-->
                                            <div class="u-s-m-b-15">

                                                <label class="gl-label"  for="billing-zip">PINCODE *</label>

                                                <input class="input-text input-text--primary-style" name="pincode" type="text" id="billing-zip" placeholder="Zip/Postal Code" data-bill=""></div>
                                            <!--====== End - ZIP/POSTAL ======-->
                                            <div class="u-s-m-b-10">

                                                <!--====== Check Box ======-->
                                                <div class="check-box"> 

                                                    <input type="checkbox" id="make-default-address" data-bill="">
                                                    <div class="check-box__state check-box__state--primary">

                                                        <label class="check-box__label" for="make-default-address">Make default shipping and billing address</label></div>
                                                </div>
                                                <!--====== End - Check Box ======-->
                                            </div>
                                            <div class="u-s-m-b-10">

                                                <a class="gl-link" href="#create-account" data-toggle="collapse">Want to create a new account?</a></div>
                                            <div class="collapse u-s-m-b-15" id="create-account">

                                                <span class="gl-text u-s-m-b-15">Create an account by entering the information below. If you are a returning customer please login at the top of the page.</span>
                                                <div>

                                                    <label class="gl-label" for="reg-password">Account Password *</label>

                                                    <input class="input-text input-text--primary-style" type="text" data-bill id="reg-password"></div>
                                            </div>
                                            <div class="u-s-m-b-10">

                                                <label class="gl-label" for="order-note">ORDER NOTE</label><textarea class="text-area text-area--primary-style" id="order-note"></textarea></div>
                                            <div>

                                                <button class="btn btn--e-transparent-brand-b-2" type="submit">SAVE</button></div>
                                        </div>
                                    </form>
                                </div>

                       

                                <div class="col-lg-6">
                                    <h1 class="checkout-f__h1">ORDER SUMMARY</h1>

                             
                                    <!--====== Order Summary ======-->
                                    <div class="o-summary">
                                         
                                        <div class="o-summary__section u-s-m-b-30">
                                            {{#each orderList}}
                                            <div class="o-summary__item-wrap gl-scroll">
                                                <div class="o-card">
                                                    <div class="o-card__flex">
                                                        <div class="o-card__img-wrap">

                                                            <img class="u-img-fluid" src="/uploads/{{image.[0]}}" alt=""></div>
                                                        <div class="o-card__info-wrap">

                                                            <span class="o-card__name">

                                                                <a href="product-detail.html">{{productname}}</a></span>

                                                            <span class="o-card__quantity">{{quantity}}</span>

                                                            <span class="o-card__price">₹ {{price}}</span></div>
                                                    </div>

                                                    <a class="o-card__del far fa-trash-alt"></a>
                                                </div>
                                                
                                            </div>
                                            {{/each}}
                                        </div>
                                        
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                
                                                <h1 class="checkout-f__h1">SHIPPING & BILLING</h1>
                                                <div class="ship-b">
                                                   {{#with address}}
                                                    <span class="ship-b__text">Ship to:</span>
                                                    <div class="ship-b__box u-s-m-b-10">
                                                        <p class="ship-b__p">{{firstname}},<br>{{streetaddress}},<br>{{phone}},<br>{{district}},<br>{{state}}</p>

                                                        <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal" data-modal-id="#edit-ship-address">Edit</a>
                                                    </div>
                                                    
                                                    <div class="ship-b__box">

                                                        <span class="ship-b__text">Bill to default billing address</span>

                                                        <a class="ship-b__edit btn--e-transparent-platinum-b-2" data-modal="modal" data-modal-id="#edit-ship-address">Edit</a></div>
                                                {{/with}}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <table class="o-summary__table">
                                                    <tbody>
                                                        {{!-- <tr>
                                                            <td>SHIPPING</td>
                                                            <td>$4.00</td>
                                                        </tr>--}}
                                                        <tr>
                                                            <td>SUBTOTAL</td>
                                                            <td>₹ {{Grandtotal}}</td>
                                                        </tr> 
                                                        <tr>
                                                            <td>Discount</td>
                                                            <td id="discount">₹ {{discountAmount}}</td>
                                                        </tr>
                                                        
                                                        <tr>
                                                            <td>GRAND TOTAL</td>
                                                            <td id="updatedTotal">₹ {{Grandtotal}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="o-summary__section u-s-m-b-30">
                                            <div class="o-summary__box">
                                                <h1 class="checkout-f__h1">PAYMENT INFORMATION</h1>


{{!-- <section style="margin-top: 10vh;" class="container"> --}}
  <form  action="" id="checkoutForm">
                          <div class="u-s-m-b-10">

                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">

                                                            <input type="radio" id="cash-on-delivery" name="paymentmethode" value="COD" checked>
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="cash-on-delivery">Cash on Delivery</label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->

                                                        <span class="gl-text u-s-m-t-6">Pay Upon Cash on delivery. (This service is only available for some countries)</span>
                                                    </div>
                                    
                                                    <div class="u-s-m-b-10">

                                                        <!--====== Radio Box ======-->
                                                        <div class="radio-box">

                                                            <input type="radio" id="pay-pal" name="paymentmethode" value="online" checked>
                                                            <div class="radio-box__state radio-box__state--primary">

                                                                <label class="radio-box__label" for="pay-pal">Pay Pal</label></div>
                                                        </div>
                                                        <!--====== End - Radio Box ======-->

                                                        <span class="gl-text u-s-m-t-6">When you click "Place Order" below we'll take you to Paypal's site to set up your billing information.</span>
                                                    </div>
                                                    <div class="u-s-m-b-15">

                                                        <!--====== Check Box ======-->
                                                        <div class="check-box">

                                                            <input type="checkbox" id="term-and-condition">
                                                            <div class="check-box__state check-box__state--primary">

                                                                <label class="check-box__label" for="term-and-condition">I consent to the</label></div>
                                                        </div>
                                                        <!--====== End - Check Box ======-->

                                                        <a class="gl-link">Terms of Service.</a>
                                                    </div>
                                                    <div>

                                                       <button class="btn btn--e-brand-b-2"  type="submit">PLACE ORDER</button></div>
 
</form>     
       
    </div>
                                        </div>
                                    </div>
                                    <!--====== End - Order Summary ======-->
                                </div>
                            
                                
                            </div>
                        </div>
                    </div>
                </div>
                <!--====== End - Section Content ======-->
            </div>
            <!--====== End - Section 3 ======-->
        </div>

       <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"> </script>

  

<script>

 //<<<<<<<<<<<<<<<<<<<<<<<<<<<< razor pay >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

  $("#checkoutForm").submit((e) => {
   
    e.preventDefault();
    const paymentMethod = document.querySelector("input[name='paymentmethode']:checked").value;

    
    if (paymentMethod == "COD") {
      $.ajax({
        url: "/placeorder",
        method: "post",
        data: $("#checkoutForm").serialize(),
        success: (response) => {
          location.replace("/confirm");
        },
      });
    }
     else {

        $.ajax({
            url:"/initiateRazorpay",
            method:"post",
            data:$("#checkoutForm").serialize(),
            success:(response)=>{
                
         

          amount = response.razorData.amount 
          console.log(amount);
          var options = {
            "key": "rzp_test_gsHCO6dbv1728y", // Enter the Key ID generated from the Dashboard
            "amount": amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
            "currency": "INR",
            "name": "LOODIEE",
            "description": "India's NO.1 furniture selling company",
            "image":"https://i.ibb.co/L6LDc6J/logoloodiee.png",
            "order_id": response.razorData.id, //This is a sample Order ID. Pass the id obtained in the response of Step 1
            "handler": function (res) {

              verifyPayment(res, response.razorData);
            },
            "prefill": {
              "name": "Gaurav Kumar",
              "email": "gaurav.kumar@example.com",
              "contact": "9999999999"
            },
            "notes": {
              "address": "Razorpay Corporate Office"
            },
            "theme": {
              "color": "#3399cc"
            }
          };
          var rzp1 = new Razorpay(options);
          rzp1.open();
          e.preventDefault();
          rzp1.on('payment.failed', function (res) {
      

          });

        

            }
        })
    }
  });

//<<<<<<<<<<<<<<<<<<<<<<<<<<< verify payment >>>>>>>>>>>>>>>>>>>>>>>>>>>

   function verifyPayment(razorResponse, razorData) {

    $.ajax({
      url: '/verifyPayment',
      data: {
        razorResponse,
        razorData
      },
      method: 'post',
      success: (res) => {
        if (res.status) {
          location.replace('/confirm');
        }
      }
    })
  }
</script>
<script>
    function couponValidator(total){
        couponId=document.getElementById('couponId').value
         $.ajax({
                url: '/applycoupon',
                data: {
            couponId:couponId,
            totalAmount:total
            },

    method: 'post',
    success: (response) => {

          $('#updatedTotal').text(response.updatedTotal);
            $('#discount').text(response.discountAmount);
        $('#couponspan').text(response.message)
        setTimeout(function() {

  $('#couponspan').text(null);
}, 3000);
   
          
    }
         });
      }
</script>
 
 



